# SEMI E5-0200A（SECS-II：消息内容）要点总结

> 日期：2026-01-04  
> 整理：Codex  
> 来源：`SEMI+E05+-+0200.pdf`（SEMI E5-0200A, © SEMI 1982, 2000）

## 0. 文档定位（这份标准“管什么”）

- **SECS-II（SEMI E5）定义的是“消息内容/语义与编码结构”**：设备（equipment）与主机（host）之间交换的 SECS 消息如何被解释、消息正文（message text）如何由数据结构（items/lists）组成，以及各 Stream/Function 的标准消息定义。
- **消息传输协议（message transfer protocol）不在本标准实现范围内**：本标准只规定 SECS-II 应用与传输协议交互时的最低要求；与 SECS-I（SEMI E4）兼容，并允许替代的传输协议。
- **应用范围**：面向半导体制造设备与主机之间的通信，涵盖控制程序传输、物料移动信息、测量数据、汇总测试数据、报警等典型活动。

## 1. 关键术语（Selected Definitions，按使用频率抽取）

- **message / message text**：消息由“消息头（由传输协议提供/承载）+ 消息正文（SECS-II 定义）”构成；message text 是消息中除 message header 之外的部分。
- **stream / function**：stream 表示消息类别（0–127），function 表示某类别中的具体消息（0–255）。stream+function 共同构成消息识别。
- **primary / secondary / reply**：primary 为奇数 function（事务第一条消息）；secondary 为偶数 function（对应 primary 的回复）；reply 是与某 primary 对应的特定 secondary。
- **transaction**：一个 primary 以及其对应 secondary（如果请求回复）；secondary **不能**请求回复。
- **block / packet**：由消息传输协议进行的物理分段；与 SECS-II 的“逻辑数据结构（items/lists）”不同。
- **originator / interpreter**：originator 创建 primary；interpreter 在目的端解释 primary 并在需要时生成 reply。
- **transaction timeout / conversation timeout**：transaction timeout 由传输协议在“期待的 reply 未在规定时间内到达”时通知；conversation timeout 属于应用层“多个事务组成的会话任务”超时。

## 2. 与消息传输协议的交互要求（Section 3）

### 2.1 传输协议需要向 SECS-II 提供/标识的关键信息（Message Header 内容要求）

传输协议必须能够让 SECS-II 识别至少以下信息：

1. **Device ID**：0–32767，用于标识消息源/目的设备。
2. **Stream + Function**：最少 15-bit 的消息识别（SECS-II 以 stream 0–127（7 bit）与 function 0–255（8 bit）识别消息）。
3. **Reply Requested**：primary 是否请求回复（传输协议需能标识这一点）。

### 2.2 单块/多块（Single-block / Multi-block）要求

- **单块消息（single-block）**：本标准中标记为 single-block 的 SECS-II 消息必须由传输协议以单 block（或单 packet）发送；与 SECS-I 兼容时，**单块 SECS-II 消息最大长度为 244 bytes**。
- **多块消息（multi-block）**：为兼容 SECS-I，长度超过 244 bytes 的消息称为 multi-block；某些消息即使长度满足单块，也允许按定义作为 multi-block。
- **实现约束演进（1988 修订）**：早期实现可能对“某些入站消息的 block 大小”有应用特定约束；自 1988 修订起，新应用**不得**对入站 block 大小施加应用特定要求（兼容旧实现的例外保留）。

### 2.3 事务超时与并发事务

- **Transaction Timeout**：当未在指定事务超时时间内收到期望的 reply，传输协议应通知 SECS-II（并在 SECS-I 中关联 T3/T4 超时语义）。
- **Multiple Open Transactions**：允许但不强制支持多个并行“未完成事务”。

## 3. Stream / Function 规则与分配（Section 4）

### 3.1 编号规则（Primary/Secondary 成对）

- primary 使用**奇数** function。
- secondary（reply）使用**偶数** function，通常为 primary function + 1。
- 若 primary “不请求回复”，则其后紧邻的偶数 function **保留，不得使用**。
- **function 0** 在所有 stream 中保留，用于“终止/中止事务”（详见 Section 7.4/各 Stream 的 SxF0）。

### 3.2 标准保留与用户自定义范围（Stream and Function Allocation）

本标准保留的 stream/function 范围：

- Stream 0：Functions 0–255
- Streams 1–63：Functions 0–63
- Streams 64–127：Function 0

用户可自定义的范围：

- Streams 1–63：Functions 64–255
- Streams 64–127：Functions 1–255

同时给出最低符合性要点（与 Section 5 关联），例如：

- 收到 `S1F1` 应按规定以 `S1F2` 响应（见 Stream 1）。
- 不能处理的消息应在 Stream 9 报告相应错误（如 `S9F1/F3/F5/F7/F11` 等）。
- 检测到 transaction timeout 时，设备侧应向主机发送 `S9F9`。
- 收到“以 function 0 作为回复”的场景，应终止关联事务且不应再额外发错（设备侧）。

## 4. 事务与会话（Transaction & Conversation Protocols，Section 5）

### 4.1 事务（Transaction）

- 事务是 SECS-II 信息交换的基础单元：  
  - primary 不请求回复；或  
  - primary 请求回复 + 对应 secondary（reply）。  
- secondary 不得请求回复。

### 4.2 会话（Conversation）与 7 类典型模式

标准将完成某个任务所需的一组事务称为 conversation，并建议在 conversation 结束时双方都不再保留资源占用。标准列出 7 类 conversation（概念摘要）：

1. **单向 primary（无 reply）**：必须是 single-block；originator 需假定对端“已响应/处理”（适用于被拒也无可挽回的场景）。
2. **request/data**：originator 请求数据，interpreter 以 reply 返回数据。
3. **send/acknowledge**：originator 发送 single-block 数据，对端以确认回复。
4. **inquire/grant/send/acknowledge**：用于 multi-block 数据发送；先请求许可（grant/deny），获准后再发送数据并确认。interpreter 在 inquire 与 send 之间可能预占资源，因此可能设置 conversation timeout；超时后释放资源并（在本标准定义下）由设备侧向主机发 `S9F13`。
5. **Data Set Transfers**：与“非格式化数据集传输”相关的 conversation，在 Stream 13 详述。
6. **Material Handling**：与物料处理相关的 conversation，在 Stream 4 详述。
7. **request/acknowledge/send/acknowledge**：originator 请求“需较长时间获取的信息”（如需操作员输入），interpreter 可能：直接返回 / 表示无法获得 / 表示将稍后以后续事务返回；后者会引入后续 send/acknowledge 以及 originator 侧的 conversation timeout 处理。

## 5. 数据结构与编码（Data Structures，Section 6）

### 5.1 两种逻辑结构：Item 与 List

- **Item**：携带实际数据的基本单元；由 **Item Header（IH）+ Item Body（IB）** 组成。
- **List**：有序元素集合；元素可以是 item 或 list。List Header（LH）形式与 item header 类似，但其长度字段表示**元素个数**而非字节数。

### 5.2 Item Header（IH）核心规则

- item 的长度与格式由**前 2/3/4 字节**定义：1 字节 format + 1/2/3 字节 length。
- format byte 的 **bit 1–2** 指示“length 字节数”（因此允许长 item 又不浪费短 item 的头部开销）。
- format byte 的 **bit 3–8** 给出格式码（64 种可能，其中本标准定义 15 种）。
- **非法/特殊长度**：
  - format byte 的“零长度”非法，会产生错误。
  - item length 字段为 0 在某些消息定义中具有特殊含义（详见各消息定义）。

### 5.3 本标准定义的 15 种数据格式（Table 1 摘要）

格式码以（bit 3–8）对应的 **八进制**表示：

- `00`：List（长度为元素个数）
- `10`：Binary
- `11`：Boolean（0=false，非 0=true）
- `20`：ASCII
- `21`：JIS-8
- `22`：Localized string（多字节字符字符串，见下）
- 有符号整数（2’s complement，MSB 先发）：`30`(8-byte), `31`(1-byte), `32`(2-byte), `34`(4-byte)
- 浮点数（IEEE 754；包含符号位的字节先发）：`40`(8-byte), `44`(4-byte)
- 无符号整数（MSB 先发）：`50`(8-byte), `51`(1-byte), `52`(2-byte), `54`(4-byte)

### 5.4 Localized Character String（格式码 `22`，Section 6.4）

- Localized string item 在 item header 之后、字符串数据之前，额外包含 **2 字节的 Localized String Header（LSH，16-bit）**，用于指定编码方式。
- LSH 被视为 item data 的一部分，因此 item header 的 length **包含**这 2 字节。
- 编码码值（十进制）示例（标准列举）：
  - `0` 保留；`1` ISO 10646 UCS-2（Unicode 2.0）；`2` UTF-8；`3` ISO 646-1991（ASCII 7-bit）；`4` ISO 8859-1（Latin-1）
  - `5` ISO 8859-11（proposed，Thai）；`6` TIS 620（Thai）；`7` IS 13194 (1991)（ISCII）
  - `8` Shift JIS；`9` Japanese EUC-JP；`10` Korean EUC-KR
  - `11` Simplified Chinese GB；`12` Simplified Chinese EUC-CN；`13` Traditional Chinese Big5；`14` Traditional Chinese EUC-TW
  - `15–32767` 保留；`32768–65535` 供自定义用途

### 5.5 字典（Dictionaries）的作用（Section 6.6–6.8）

- **Data Item Dictionary（6.6）**：为标准 SECS-II 消息（Section 7）中出现的数据项定义助记名（Name）、允许格式（Format，使用 Table 1 的格式码及 3()/4()/5() 记法）、含义（Description）与出现位置（Where Used）。
- **Variable Item Dictionary（6.7）**：定义主机用于采集的“变量数据项”，并标注 Class：  
  - `SV`（Status Value）：始终有效；  
  - `DVVAL`（Data Value）：可能仅在特定事件发生时有效；  
  - `ECV`（Equipment Constant）：主机可设置。  
  标准示例中给出 `CLOCK` 的格式要求为 `YYYYMMDDhhmmsscc`（cc=centisecond）。
- **Object Dictionary（6.8）**：定义通过 SECS-II 可访问的对象（objects）及其公开属性（attributes），以表格描述 Attribute Name/Definition/Access（RO/RW）/Format/Value，并包含枚举型取值约束示例（如 Carrier 的 Slot 状态枚举等）。

## 6. 消息定义与使用规则（Message Detail，Section 7 的“框架性内容”）

### 6.1 标准消息定义的组织方式

- 按 Stream 划分；每个函数以标准化模板描述：编号、名称、是否单块/多块、方向、是否需要 reply、描述、变量定义、以及由 lists/items 构成的详细结构。

### 6.2 Zero-length Items/Lists 的含义（7.3.1）

- 对于命令/请求类消息：可用来表示“未包含的数据项使用默认值”（默认值可能是固定值或设备选择的值）。
- 对于数据上报类消息（响应或异步报告）：可表示“信息不可用/不适用”；某些情况下“不提供数据”本身也可能表达成功/失败。
- 某些消息定义会将零长度 item 或零长度 list 定义为“信息未提供”，接收方需自行决定如何处理。

### 6.3 标准消息的格式符合性（7.3.2）

任何标准 SECS-II 消息必须遵循对应 Stream/Function 的 Message Definition：

1. 必须包含定义中要求的所有 Lists 与 Data Items。
2. 除非定义允许，不得包含定义中未出现的 Lists/Data Items。
3. 除非定义赋予含义，不得包含零长度的 List/Data Item。

### 6.4 Stream 0 / Function 0（7.4）

- **Stream 0**：被定义为“不使用”（因为 0 最可能是错误），不定义任何函数。
- **Function 0**：存在于所有 stream，用于关闭事务，避免 originator 等待 transaction timeout；当 interpreter 因传输错误或其他原因无法返回预期 reply 时，可用 function 0 代替预期 secondary 来终止事务（但并非强制要求必须发送）。

## 7. 各 Stream 的“用途概览”（Section 7 各 Stream 的开头描述）

> 说明：以下为每个 Stream 在标准中的用途描述摘要，用于写作时做“框架分层”和“能力边界”对齐；具体函数与结构详见原文对应 Stream 的函数表。

- **Stream 1（Equipment Status）**：交换设备状态信息（模式、消耗品耗尽、传输操作状态等）。
- **Stream 2（Equipment Control and Diagnostics）**：主机对设备的远程控制、设备自诊断与校准；**不包含**与物料传输（Stream 4）、装载执行/引导程序（Stream 8）、文件/OS 调用（Streams 10/13）相关的控制；并在 Stream 17 有延续。
- **Stream 3（Materials Status）**：与物料相关的信息与动作（载具、在制品、完成时间信息、异常物料事件等）。
- **Stream 4（Material Control）**：物料控制；包含原始物料控制协议以及支持 SEMI E32 的新协议；涉及物料转移握手、卡料/丢料等异常与恢复语义，并向主机报告错误或完成转移。
- **Stream 5（Exception Handling）**：二进制/模拟设备异常处理；区分 errors 与 alarms；并给出使用 F1–F8 时的报警分类（人身安全、设备安全、参数控制告警/错误、不可恢复错误、状态告警、attention flags、数据完整性等）。
- **Stream 6（Data Collection）**：在制测量与设备监控的数据采集（如 trace 数据发送等）。
- **Stream 7（Process Program Management）**：工艺程序管理与传输（建立程序与待加工物料之间的关联；支持未格式化/格式化工艺程序传输）。
- **Stream 8（Control Program Transfer）**：传输设备用于控制功能或执行工艺程序的程序（如 boot program、executive program 等）。
- **Stream 9（System Errors）**：通知主机“收到无法处理的消息块”或“事务（接收）计时器超时”；区分 Message Fault 与 Communications Fault，并明确 Communications Failure（SECS-I 中 RTY 超限）时不发送 Stream 9 消息；包含 `S9F9`（Transaction Timer Timeout）与 `S9F13`（Conversation Timeout）等。
- **Stream 10（Terminal Services）**：主机与设备操作员终端之间的文本消息传递；设备不解释文本；人机响应时间管理由主机负责。
- **Stream 11**：已删除并被认为过时，标准不再收录并不鼓励使用。
- **Stream 12（Wafer Mapping）**：与晶圆坐标位置及其关联数据（如 binning、map 格式变体等）相关的消息集合。
- **Stream 13（Data Set Transfers）**：数据集传输协议（非通用文件访问机制）；支持离散/流式记录、分消息传输、无任意长度上限（由收发双方决定每条消息最大数据量）、支持中断后的重启等；用 OPEN/READ/CLOSE 与 SEND 间接写入。
- **Stream 14（Object Services）**：通用对象操作（获取对象信息、设置对象属性等）；支持对象说明符（层级关系）、可选过滤条件与属性关系限定；对通配符与过滤的支持并非强制。
- **Stream 15（Recipe Management）**：配方/命名空间/执行器相关操作；配方以分段（sections）传输，段可为配方属性、agent-specific dataset 属性或配方正文；支持多块传输的 Inquire/Grant 等流程。
- **Stream 17（Equipment Control and Diagnostics）**：Stream 2 的延续，扩展设备控制与诊断能力（如数据报告/事件报告等定义与管理）。
- **Stream 18（Subsystem Control and Data）**：组件子系统与上层控制器之间的消息；相较于设备-主机消息更简化。

## 8. 写 SECS 框架时可直接复用的“结构骨架”

- **分层**：SECS-II（E5）定义消息内容与数据结构；传输层可为 SECS-I（E4）或 HSMS（E37）等；写作时把“消息语义/结构”与“链路/会话/超时/重传”分开描述。
- **命名与约束**：使用 `SxFy`、primary/secondary（奇/偶）与 W-bit（reply requested）作为主线；将 function 0、Stream 9 错误、零长度语义、244 bytes 单块边界、以及 multi-block 的 inquire/grant 模式作为实现边界与互操作要点。
- **字典化描述**：按 E5 的 Data Item / Variable / Object 三类字典方式，把“数据项定义（格式码/含义/出现位置）”与“消息结构（L,n + <ITEM>）”拆开写，便于对照原文 Section 6 与 Section 7。

