# SECS-I 标准要点总结

## 文档信息
- **标准编号**: SEMI E4-0699
- **标准名称**: SEMI 设备通信标准 1 - 消息传输 (SECS-I)
- **版本**: 1999年版（原始版本发布于1980年）

## 1. 标准范围与目的

### 1.1 适用范围
- 定义半导体加工设备与主机之间的串行点对点通信接口
- 适用设备包括：晶圆制造、晶圆加工、工艺测量、组装和封装设备
- **不定义**消息内容（由SECS-II标准定义）

### 1.2 协议分层
SECS-I采用分层协议结构：
1. **物理链路层** - 物理连接和电气特性
2. **块传输协议** - 数据块传输和错误检测
3. **消息协议** - 完整消息的组装和事务管理

## 2. 物理接口规范

### 2.1 连接器
- **25针连接器**: 设备端为母头，电缆端为公头
- **9针连接器**: 设备端为公头，电缆端为母头
- 两种连接器均采用D型，带4-40螺纹锁定

### 2.2 信号引脚（必需）

| 25针 | 9针 | 信号 | 说明 |
|------|-----|------|------|
| 1 | - | 屏蔽 | Shield |
| 2 | 3 | BA | 来自设备的数据 |
| 3 | 2 | BB | 到设备的数据 |
| 7 | 5 | AB | 信号地 |
| 18 | - | - | +12至+15V（可选）|
| 25 | - | - | -12至-15V（可选）|

### 2.3 电气特性
- **逻辑1**: 电压 < -3V
- **逻辑0**: 电压 > +3V
- **电压范围**: ±25V以内
- **标准**: 符合EIA RS-232-C

### 2.4 数据速率
- **必需支持**: 9600, 4800, 2400, 1200, 300 波特
- **可选支持**: 19200, 150 波特
- **精度要求**: ±0.5%

## 3. 字符结构

每个字符10位：
```
[起始位(0)] [数据位1-8] [停止位(1)]
```
- 1个起始位（0）
- 8个数据位（从低位到高位）
- 1个停止位（1）
- 字符间异步传输

## 4. 块传输协议

### 4.1 握手字节

| 名称 | 字节码 | 功能 |
|------|--------|------|
| ENQ | 00000101 | 请求发送 |
| EOT | 00000100 | 准备接收 |
| ACK | 00000110 | 正确接收 |
| NAK | 00010101 | 错误接收 |

### 4.2 超时参数

| 参数 | 说明 | 典型值 | 范围 |
|------|------|--------|------|
| T1 | 字符间超时 | 0.5秒 | 0.1-10秒 |
| T2 | 协议超时 | 10秒 | 0.2-25秒 |

### 4.3 主/从关系
- **主机(Master)**: 设备端
- **从机(Slave)**: 主机端
- 用于解决线路争用（contention）

### 4.4 块结构
```
[长度字节(1)] [消息头(10)] [数据(0-244)] [校验和高(1)] [校验和低(1)]
```
- **块长度**: 10-254字节（不含长度字节和校验和）
- **最大数据**: 244字节
- **校验和**: 16位，所有字节的无符号二进制和

### 4.5 重试机制
- **RTY参数**: 重试次数限制（典型值3，范围0-31）
- 超过重试次数后声明发送失败

## 5. 消息头结构（10字节）

```
字节1: [R位] [设备ID高7位]
字节2: [设备ID低8位]
字节3: [W位] [消息ID高7位]
字节4: [消息ID低8位]
字节5: [E位] [块号高7位]
字节6: [块号低8位]
字节7-10: [系统字节4字节]
```

### 5.1 各字段说明

| 字段 | 位数 | 说明 |
|------|------|------|
| **R位** | 1位 | 0=发送到设备，1=发送到主机 |
| **设备ID** | 15位 | 设备标识符（0-32767） |
| **W位** | 1位 | 1=期待回复，0=不期待回复 |
| **消息ID** | 15位 | 消息格式和内容标识 |
| **E位** | 1位 | 1=最后一块，0=还有后续块 |
| **块号** | 15位 | 多块消息中的块编号（1-32767） |
| **系统字节** | 32位 | 消息标识和事务关联 |

### 5.2 消息类型
- **主消息(Primary)**: 消息ID为奇数（最低位=1）
- **次消息(Secondary)**: 消息ID为偶数（最低位=0）

## 6. 消息协议

### 6.1 消息定义
- **消息**: 一个方向上的完整通信单元
- **单块消息**: 一个块包含完整消息
- **多块消息**: 消息分为多个块（最多32,767块）

### 6.2 消息长度限制
- **单块最大数据**: 244字节
- **消息最大长度**: 244 × 32,767 = 7,995,148字节

### 6.3 超时参数

| 参数 | 说明 | 典型值 | 范围 |
|------|------|--------|------|
| T3 | 回复超时 | 45秒 | 1-120秒 |
| T4 | 块间超时 | 45秒 | 1-120秒 |

### 6.4 事务(Transaction)
- **定义**: 主消息及其对应的次消息（如有）
- **事务打开**: 发送主消息第一块时
- **事务关闭**:
  - 不需回复的主消息：最后一块发送成功后
  - 需要回复的主消息：收到回复的最后一块后

### 6.5 回复链接
- 次消息的系统字节必须与对应主消息相同
- 通过系统字节匹配主消息和次消息

### 6.6 重复块检测
- 通过比较完整的10字节消息头检测重复块
- 重复块应被丢弃

## 7. 参数设置要求

### 7.1 必需参数

| 参数 | 说明 | 用户可调 | 非易失性存储 |
|------|------|----------|-------------|
| BAUD | 波特率 | 是 | 是 |
| DEVID | 设备ID | 是 | 是 |
| T1 | 字符间超时 | 是 | 是 |
| T2 | 协议超时 | 是 | 是 |
| T3 | 回复超时 | 是 | 是 |
| T4 | 块间超时 | 是 | 是 |
| RTY | 重试限制 | 是 | 是 |
| M/S | 主/从 | 否 | 是 |

### 7.2 存储要求
- 所有参数必须存储在非易失性存储器中
- 断电或软件重载后设置应保持

## 8. 协议流程示例

### 8.1 正常消息发送流程
```
发送方                    接收方
  |-------- ENQ -------->|
  |<------- EOT ---------|
  |---- 长度字节 ------->|
  |------ 消息头 ------->|
  |------- 数据 -------->|
  |---- 校验和高 ------->|
  |---- 校验和低 ------->|
  |<------- ACK ---------|
```

### 8.2 线路争用解决
```
设备(主)               主机(从)
  |------ ENQ --------->|
  |<------ ENQ ---------|  (同时发送)
  |                     |
  |<------ EOT ---------|  (从机延迟自己的发送)
  |---- 数据块 -------->|
  |<------ ACK ---------|
```

## 9. 文档要求

实施SECS-I的设备或主机必须提供以下文档：

1. 所有参数的设置方法
2. 每个参数的允许范围和分辨率
3. 重复块检测的兼容性和启用/禁用方法
4. 正常操作下的最大延迟时间
5. 是否支持接收多块消息
6. 是否作为发送方使用多块消息
7. 接收消息的大小限制
8. 发送消息的最大预期大小
9. 是否支持接收消息交错
10. 是否作为发送方使用消息交错
11. 端口支持的设备ID数量
12. 支持的最大并发开放事务数

## 10. 关键设计要点

### 10.1 可靠性机制
- **校验和**: 检测传输错误
- **超时**: 检测通信失败
- **重试**: 自动恢复暂时性错误
- **确认**: 确保块正确接收

### 10.2 性能考虑
- 建议多块消息使用最大块长度（254字节）
- 接收方应能接受11-254字节的任意块大小
- 主机发送长消息时应留出间隙让从机发送

### 10.3 网络应用
- SECS-I主要用于点对点通信
- 可在树形网络中使用
- R位和设备ID用于消息路由

## 11. 与SECS-II的关系

SECS-I定义传输层，SECS-II定义应用层：
- SECS-I: **如何**传输消息（物理层、块传输、消息协议）
- SECS-II: 消息**内容**是什么（数据格式、消息定义）

消息头中的某些字段由SECS-II定义含义：
- 字节3（去除W位）= Stream（流）
- 字节4 = Function（功能）

---

**注**: 本文档基于SEMI E4-0699标准整理，实际实现时应参考完整标准文档。
